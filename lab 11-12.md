# Lab 11â€“12 â€“ Secure User Management & Data Isolation (Spring Boot)

This repository contains the **Lab 11â€“12** project, a security-focused Spring Boot application designed to demonstrate **secure authentication**, **authorization**, and **strict per-user data isolation**.

The project goes beyond basic CRUD by enforcing **row-level security**, **defense-in-depth**, and **real-world secure coding practices** expected in production systems.

---

## ðŸŽ¯ Project Goal

The main objective of this lab is to prove that:

* Users can **only access their own data** (Notes / Tasks)
* Authentication and authorization are **properly enforced**
* Sensitive data is **securely stored and processed**
* Common web attacks are **actively mitigated**

This project was implemented explicitly with **security verification in mind**, not just functionality.

---

## ðŸ” Core Security Features

### 1ï¸âƒ£ Authentication & Authorization (Spring Security)

* **Session-based Authentication**

  * Secure server-side session created after login
  * Prevents token leakage and replay attacks

* **Custom UserDetailsService**

  * User credentials loaded directly from the database (H2 / JDBC)
  * Full control over authentication logic

* **BCrypt Password Hashing**

  * Passwords are never stored in plaintext
  * Explicit configuration:

```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder(10); // Explicit strength
}
```

**Why strength = 10?**

* Resistant to brute-force attacks
* Balanced CPU cost (secure but performant)

---

### 2ï¸âƒ£ Data Isolation (Row-Level Security)

âš ï¸ **This is the most critical part of the project.**

Each Note belongs to exactly **one user** via `user_id`.

#### Defense Strategy

âœ” Service-layer ownership validation
âœ” SQL-level access control
âœ” No trust in URL parameters

#### SQL-Level Enforcement (Critical)

Every sensitive operation includes:

```sql
WHERE id = ? AND user_id = ?
```

This prevents:

* ID guessing attacks
* Horizontal privilege escalation
* Direct URL manipulation

#### Repository Example

```java
public void deleteByIdAndUserId(Long id, Long userId) {
    String sql = "DELETE FROM notes WHERE id = ? AND user_id = ?";
    jdbcTemplate.update(sql, id, userId);
}
```

Even if an attacker guesses a valid ID, **the query silently fails**.

---

### 3ï¸âƒ£ Defense Mechanisms

* **CSRF Protection**

  * Enabled by default in Spring Security
  * Thymeleaf forms include CSRF tokens automatically

* **SQL Injection Prevention**

  * All queries use `JdbcTemplate` + Prepared Statements
  * No string concatenation

* **JSON Metadata Storage**

  * User preferences stored as flexible JSON
  * Allows schema evolution without breaking DB structure

* **Secure Logging**

  * Passwords and sensitive fields never logged
  * Logs contain only operational metadata

---

## ðŸ— Technical Architecture

The project follows **Layered Architecture**:

```
Controller  â†’ HTTP + Status Codes (200 / 403 / 404)
Service     â†’ Business Logic + Access Control
Repository  â†’ SQL Queries (with user_id isolation)
DTO         â†’ Validation (@Email, @NotBlank, @Size)
Model       â†’ Domain Entities
```

Security checks exist on **multiple layers** â€” failure at one layer does not expose data.

---

## ðŸ“‚ API Endpoints

| Method | Path               | Description    | Access        |
| ------ | ------------------ | -------------- | ------------- |
| GET    | /login             | Login page     | Public        |
| POST   | /register          | Create user    | Public        |
| GET    | /notes             | View own notes | Authenticated |
| POST   | /notes/delete/{id} | Delete note    | Owner only    |

---

## ðŸ§ª Instructor FAQ (Security-Oriented)

### â“ Can one user delete another userâ€™s note?

**No.** Protection exists on **two levels**:

1. Service layer validates ownership
2. SQL query enforces `AND user_id = ?`

If the IDs donâ€™t match â†’ **0 rows affected**.

---

### â“ Why explicitly configure BCrypt strength?

```java
new BCryptPasswordEncoder(10)
```

* Makes security intention explicit
* Prevents accidental downgrade
* Matches real-world security audits

---

### â“ How is sensitive data protected in logs?

* Passwords never logged
* Emails masked when necessary
* Logs contain only action-level events

---

## ðŸ—„ Database Schema

The `notes` table enforces ownership via a foreign key:

```sql
CREATE TABLE notes (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255),
    content TEXT,
    user_id BIGINT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

Flyway / schema.sql ensures consistency and integrity.

---

## ðŸšª Logout Handling

* Explicit logout endpoint configured
* Session invalidated securely
* Redirects to:

```
/login?logout
```

---

## ðŸ›  Technologies Used

* Java 17+
* Spring Boot
* Spring Security
* JDBC / JdbcTemplate
* BCrypt
* Thymeleaf
* H2 Database
* Flyway (Schema Migration)

---

## â–¶ï¸ How to Run

```bash
mvn clean install
mvn spring-boot:run
```

Access:

```
http://localhost:8080/login
```

---

## ðŸ§  Security Mindset (Key Takeaway)

This project was designed with the assumption that:

> **All user input is hostile until proven otherwise.**

Every critical operation is:

* Verified
* Scoped
* Constrained

---

## âœ¨ Author

**Ibrahim Aliyev**
Cybersecurity & Backend Developer

---

âœ… **Lab 11â€“12 â€“ Security Requirements Fully Implemented**
